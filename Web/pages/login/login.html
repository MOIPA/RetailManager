<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>login&singup</title>
    <script src="../../jquery/jquery-3.2.1.js"></script>
    <script src="../../jquery/md5.js"></script>
    <link rel="stylesheet" href="./login.css">
</head>

<body>
    <div class="login-page">
        <div class="form">
            <form class="register-form">
                <input type="text" placeholder="name" />
                <input type="password" placeholder="password" />
                <input type="text" placeholder="email address" />
                <input type="text" placeholder="phone" />
                <button type="submit" id="register-button">create</button>
                <p class="message">Already registered? <a href="#">Sign In</a></p>
            </form>
            <form class="login-form">
                <input id="login-name" type="text" placeholder="username" />
                <input id="login-password" type="password" placeholder="password" />
                <button type="submit" id="login-button">login</button>
                <p class="message">Not registered? <a href="#">Create an account</a></p>
            </form>
        </div>
    </div>
    <script type="module">
        import urlInfo from '../baseURL.js'
        $('.message a').click(function () {
            $('form').animate({ height: "toggle", opacity: "toggle" }, "slow");
            console.log("change");
        });
        $('#login-button').click((event) => {
            event.preventDefault();
            // 生成token
            var rod = Math.round(1, 100);
            var md5rod = $.md5(rod + 'author');
            console.log(md5rod);
            $.get(urlInfo.baseUrl + urlInfo.login, {
                name: $("#login-name").val(),
                pwd: $('#login-password').val(),
                sessionToken: md5rod
            }, function (data, status) {
                if (data != null && data!="") {
                    localStorage.setItem("token",md5rod);
                    localStorage.setItem("userId",data.id)
                    localStorage.setItem("user",data);
                    window.location.href = "../index/index.html";
                    window.event.returnValue = false;
                } else {
                    alert("error user or password");
                    $("#login-name").val("");
                    $("#login-password").val("");
                }
            });
        });
        $('#register-button').click((event) => {
            event.preventDefault();
        });
    </script>
</body>

</html>